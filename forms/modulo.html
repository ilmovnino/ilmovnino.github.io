<!DOCTYPE html>
<head>
   <title>Modulo</title>
   <meta charset="utf-8">
   <meta name="robots" content="noindex">
   <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, minimal-ui">
   <script src="jspdf.js"></script>
   <script>
       var token = "";
       function load() {
         if (navigator.onLine) {
           if(location.hash.slice(0,14) != "#access_token=") {
               window.location = "https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=464a2754-56ee-43db-9253-89c9af237687&scope=files.readwrite%20offline_access&response_type=token&redirect_uri=https://www.ilmovnino.tk/forms/modulo";
           } else {
               token = location.hash.slice(14, location.hash.indexOf("&"));
               location.hash = "";
               if(localStorage.isJob == "true") { cloud(localStorage.job) }; localStorage.isJob = "false";
           };
         } else {
             document.getElementById("cloud").innerHTML = "Sei offline";
             document.getElementById("cloud").createAttribute("disabled","disabled");
         };
       }
       function save() {
           var body = "Problem Reported: " + document.getElementById("a").value + "\r\n" + "Problem Observed: " + document.getElementById("b").value + "\r\n" + "Problem Cause: " + document.getElementById("c").value + "\r\n" + "Solution: " + document.getElementById("d").value + "\r\n" + "Verification of Repair: Verified repair per enstablished procedures. Results meet published performance specifications. System validation documented in customer QC record.";
           var blob = new Blob([body], {type:"text/plain"});
           var url = "";
           var reader  = new FileReader();
           reader.addEventListener("load", function () {
               url = reader.result;
               var title = new Date().getTime() + ".txt";
               document.getElementById("f").innerHTML += "<a href='" + url + "' download='" + title + "'>" + title + "</a><br/>";
           }, false);
           reader.readAsDataURL(blob);
       };
       function empty() {
           document.getElementById("a").value = ""; document.getElementById("b").value = ""; document.getElementById("c").value = ""; document.getElementById("d").value = ""; document.getElementById("e").value = "";
       };
       function cloud(body) {
           var xhr = new XMLHttpRequest();
           xhr.onreadystatechange = function() {
               if (this.readyState == 4 && (this.status == 200 || this.status == 201)) {
                   // Typical action to be performed when the document is ready:
                   var result = JSON.parse(xhr.responseText);
                   //document.getElementById("f").innerHTML += "<a href='" + result.webUrl + "' download='" + result.name + "'>" + result.name + "</a><br/>";
                   document.getElementById("f").innerHTML += "<a href='" + result["@microsoft.graph.downloadUrl"] + "' download='" + result.name + "'>" + result.name + "</a><br/>";
               } else {
                   localStorage.isJob = "true";
                   localStorage.job = body;
               };
           };
           var title = new Date().getTime() + ".txt";
           xhr.open("PUT", "https://graph.microsoft.com/v1.0/me/drive/root:/Moduli/" + title + ":/content", true);
           xhr.setRequestHeader("Content-Type", "text/plain");
           xhr.setRequestHeader("Authorization", "Bearer " + token);
           if(body == null) { var body = "Problem Reported: " + document.getElementById("a").value + "\r\n" + "Problem Observed: " + document.getElementById("b").value + "\r\n" + "Problem Cause: " + document.getElementById("c").value + "\r\n" + "Solution: " + document.getElementById("d").value + "\r\n" + "Verification of Repair: Verified repair per enstablished procedures. Results meet published performance specifications. System validation documented in customer QC record." };
           xhr.send(body);
       };
      function pdf() {
         var doc = new jsPDF()
         doc.setFontSize(22)
         doc.text(20, 20, 'WO-6181235.txt');
         doc.setFontSize(16)
         doc.text(20, 30, "Problem Reported: " + document.getElementById("a").value);
         doc.setFontSize(16)
         doc.text(20, 30, "Problem Observed: " + document.getElementById("b").value);
         doc.setFontSize(16)
         doc.text(20, 30, "Problem Cause: " + document.getElementById("c").value);
         doc.setFontSize(16)
         doc.text(20, 30, "Solution: " + document.getElementById("d").value);
         doc.setFontSize(16)
         doc.text(20, 30, "Verification of Repair: Verified repair per enstablished procedures. Results meet published performance specifications. System validation documented in customer QC record.");
      }
   </script>
</head>
<body onload="load()" style="font-family: arial">
    <h1>Modulo</h1>
    Problem Reported: <input type="text" id="a"><br/>
    Problem Observed: <input type="text" id="b"><br/>
    Problem Cause: <input type="text" id="c"><br/>
    Solution: <input type="text" id="d"><br/>
    Verification of Repair: Verified repair per enstablished procedures. Results meet published performance specifications. System validation documented in customer QC record.<br/><br/>
    <button onclick="save()">Salva</button> <button onclick="empty()">Svuota</button> <button onclick="cloud()" id="cloud">Carica</button><br/><br/>
    <h3>File salvati o caricati:</h3>
    <div id="f"></div><br/>
    <p>Premi "Salva" per creare un file .txt in locale che puoi scaricare facendo click sul link oppure premi "Carica" per creare un file .txt all'interno della cartella "Moduli" che trovi nella radice del tuo OneDrive. Premi "Svuota" per svuotare tutti i campi.</p>
</body>
